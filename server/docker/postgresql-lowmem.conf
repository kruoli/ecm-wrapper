# PostgreSQL configuration for low-memory environments (1GB RAM total)
# Include this in your docker-compose with:
#   volumes:
#     - ./docker/postgresql-lowmem.conf:/etc/postgresql/conf.d/lowmem.conf:ro
#   command: postgres -c 'config_file=/etc/postgresql/postgresql.conf' -c 'include_dir=/etc/postgresql/conf.d'
#
# Or mount as the main config.

# Memory settings - conservative for 1GB droplet
# Assume ~400MB available for PostgreSQL (rest for OS, Python app, etc.)
shared_buffers = 128MB              # 25% of available PG memory
effective_cache_size = 256MB        # Hint for query planner
work_mem = 4MB                      # Per-operation memory (sorts, hashes)
maintenance_work_mem = 64MB         # For VACUUM, CREATE INDEX, etc.

# Connection settings
max_connections = 20                # Reduced from default 100
superuser_reserved_connections = 2

# Write-ahead log
wal_buffers = 4MB
checkpoint_completion_target = 0.9

# Query planner
random_page_cost = 1.1              # Assume SSD storage
effective_io_concurrency = 200      # SSD setting

# Logging (optional - helps debug slow queries)
log_min_duration_statement = 1000   # Log queries taking > 1 second
log_lock_waits = on
